(function(a){jQuery.event.props.push("dataTransfer");var b={fallback_id:"",url:"",refresh:1000,paramname:"userfile",allowedfiletypes:[],maxfiles:25,maxfilesize:1,queuefiles:0,queuewait:200,data:{},headers:{},drop:f,dragStart:f,dragEnter:f,dragOver:f,dragLeave:f,docEnter:f,docOver:f,docLeave:f,beforeEach:f,afterAll:f,rename:f,error:function(e,k,l,m){alert(e)},uploadStarted:f,uploadFinished:f,progressUpdated:f,globalProgressUpdated:f,speedUpdated:f},g=["BrowserNotSupported","TooManyFiles","FileTooLarge","FileTypeNotAllowed","NotFound","NotReadable","AbortError","ReadError"],c,j=false,i=0,h;a.fn.filedrop=function(x){var y=a.extend({},b,x),v=[];this.on("drop",s).on("dragstart",y.dragStart).on("dragenter",p).on("dragover",r).on("dragleave",q);a(document).on("drop",l).on("dragenter",m).on("dragover",o).on("dragleave",n);a("#"+y.fallback_id).change(function(C){y.drop(C);h=C.target.files;i=h.length;B()});function s(C){if(y.drop.call(this,C)===false){return false}h=C.dataTransfer.files;if(h===null||h===undefined||h.length===0){y.error(g[0]);return false}i=h.length;B();C.preventDefault();return false}function t(H,G,I,C){var F="--",E="\r\n",D="";if(y.data){var J=a.param(y.data).replace(/\+/g,"%20").split(/&/);a.each(J,function(){var L=this.split("=",2),K=decodeURIComponent(L[0]),M=decodeURIComponent(L[1]);D+=F;D+=C;D+=E;D+='Content-Disposition: form-data; name="'+K+'"';D+=E;D+=E;D+=M;D+=E})}D+=F;D+=C;D+=E;D+='Content-Disposition: form-data; name="'+y.paramname+'"';D+='; filename="'+H+'"';D+=E;D+="Content-Type: "+I;D+=E;D+=E;D+=G;D+=E;D+=F;D+=C;D+=F;D+=E;return D}function z(E){if(E.lengthComputable){var G=Math.round((E.loaded*100)/E.total);if(this.currentProgress!==G){this.currentProgress=G;y.progressUpdated(this.index,this.file,this.currentProgress);v[this.global_progress_index]=this.currentProgress;w();var F=new Date().getTime();var D=F-this.currentStart;if(D>=y.refresh){var C=E.loaded-this.startData;var H=C/D;y.speedUpdated(this.index,this.file,H);this.startData=E.loaded;this.currentStart=F}}}}function w(){if(v.length===0){return}var D=0,C;for(C in v){if(v.hasOwnProperty(C)){D=D+v[C]}}y.globalProgressUpdated(Math.round(D/v.length))}function B(){j=false;if(!h){y.error(g[0]);return false}if(y.allowedfiletypes.push&&y.allowedfiletypes.length){for(var D=h.length;D--;){if(!h[D].type||a.inArray(h[D].type,y.allowedfiletypes)<0){y.error(g[3],h[D]);return false}}}var E=0,F=0;if(i>y.maxfiles&&y.queuefiles===0){y.error(g[1]);return false}var L=[];var J=[];var C=[];for(var G=0;G<i;G++){L.push(G)}var H=function(M){setTimeout(I,M);return};var I=function(){var N;if(j){return false}if(y.queuefiles>0&&J.length>=y.queuefiles){return H(y.queuewait)}else{N=L[0];L.splice(0,1);J.push(N)}try{if(k(h[N])!==false){if(N===i){return}var P=new FileReader(),O=1048576*y.maxfilesize;P.index=N;if(h[N].size>O){y.error(g[2],h[N],N);J.forEach(function(R,Q){if(R===N){J.splice(Q,1)}});F++;return true}P.onerror=function(Q){switch(Q.target.error.code){case Q.target.error.NOT_FOUND_ERR:y.error(g[4]);return false;case Q.target.error.NOT_READABLE_ERR:y.error(g[5]);return false;case Q.target.error.ABORT_ERR:y.error(g[6]);return false;default:y.error(g[7]);return false}};P.onloadend=!y.beforeSend?K:function(Q){y.beforeSend(h[N],N,function(){K(Q)})};P.readAsBinaryString(h[N])}else{F++}}catch(M){J.forEach(function(R,Q){if(R===N){J.splice(Q,1)}});y.error(g[0]);return false}if(L.length>0){I()}};var K=function(O){var Q=((typeof(O.srcElement)==="undefined")?O.target:O.srcElement).index;if(O.target.index===undefined){O.target.index=u(O.total)}var X=new XMLHttpRequest(),W=X.upload,P=h[O.target.index],S=O.target.index,V=new Date().getTime(),M="------multipartformboundary"+(new Date()).getTime(),R=v.length,N,U=A(P.name),T=P.type;if(y.withCredentials){X.withCredentials=y.withCredentials}if(typeof U==="string"){N=t(U,O.target.result,T,M)}else{N=t(P.name,O.target.result,T,M)}W.index=S;W.file=P;W.downloadStartTime=V;W.currentStart=V;W.currentProgress=0;W.global_progress_index=R;W.startData=0;W.addEventListener("progress",z,false);if(jQuery.isFunction(y.url)){X.open("POST",y.url(),true)}else{X.open("POST",y.url,true)}X.setRequestHeader("content-type","multipart/form-data; boundary="+M);a.each(y.headers,function(Y,Z){X.setRequestHeader(Y,Z)});X.sendAsBinary(N);v[R]=0;w();y.uploadStarted(S,P,i);X.onload=function(){var ab=null;if(X.responseText){try{ab=jQuery.parseJSON(X.responseText)}catch(Y){ab=X.responseText}}var Z=new Date().getTime(),ac=Z-V,aa=y.uploadFinished(S,P,ab,ac,X);E++;J.forEach(function(ae,ad){if(ae===Q){J.splice(ad,1)}});C.push(Q);v[R]=100;w();if(E===(i-F)){e()}if(aa===false){j=true}if(X.status<200||X.status>299){y.error(X.statusText,P,Q,X.status)}}};I()}function u(D){for(var C=0;C<i;C++){if(h[C].size===D){return C}}return undefined}function A(C){return y.rename(C)}function k(C){return y.beforeEach(C)}function e(){return y.afterAll()}function p(C){clearTimeout(c);C.preventDefault();y.dragEnter.call(this,C)}function r(C){clearTimeout(c);C.preventDefault();y.docOver.call(this,C);y.dragOver.call(this,C)}function q(C){clearTimeout(c);y.dragLeave.call(this,C);C.stopPropagation()}function l(C){C.preventDefault();y.docLeave.call(this,C);return false}function m(C){clearTimeout(c);C.preventDefault();y.docEnter.call(this,C);return false}function o(C){clearTimeout(c);C.preventDefault();y.docOver.call(this,C);return false}function n(C){c=setTimeout((function(D){return function(){y.docLeave.call(D,C)}})(this),200)}return this};function f(){}try{if(XMLHttpRequest.prototype.sendAsBinary){return}XMLHttpRequest.prototype.sendAsBinary=function(k){function e(n){return n.charCodeAt(0)&255}var l=Array.prototype.map.call(k,e);var m=new Uint8Array(l);this.send(m.buffer)}}catch(d){}})(jQuery);